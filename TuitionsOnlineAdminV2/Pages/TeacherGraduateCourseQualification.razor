@* Authors: VM, SN
   Date: 2/18/2021
   Aim: To display the list of teachers and graduate course and to display the graduate course associated with the selected teacher*@


@page "/TeacherGraduateCourseQualification"
@using TuitionsOnlineAdmin.CoreBusiness
@using TuitionsOnlineAdmin.UseCases.TeacherBasicInformations.ViewTeacherBasicInformationScreen.Interfaces
@using TuitionsOnlineAdmin.UseCases.GraduateCourses.ViewGraduateCourseScreen.Interfaces
@inject IViewTeacherBasicInformationUseCase diIViewTeacherBasicInformationUseCase
@inject IViewGraduateCourseUseCase diIViewGraduateCourseUseCase
<center><h3>Associate Teachers with their Graduate Course qualification here.</h3></center>
<br />
<br />

<DxGridLayout CssClass="mw-1100 border_style" style=" height: auto; margin-bottom: 10px;">
    <Rows>
        <DxGridLayoutRow Height="auto" />
    </Rows>
    <Columns>
        <DxGridLayoutColumn Width="50%" />
        <DxGridLayoutColumn Width="50%" />
    </Columns>
    <Items>
        <DxGridLayoutItem Row="0" Column="0">
            <Template>
                <div class="searchbar_style">
                    <center><h5>Select Teacher Name</h5></center>
                    <div>

                        @* this TextBox is used to search the data  *@
                        <DxTextBox ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                                   SizeMode="SizeMode.Small"
                                   NullText="Search for Teachers ...."></DxTextBox>
                    </div>
                    <br />

                    <DxDataGrid Data="@teacherList" @ref="@teacherGrid"
                                KeyFieldName="@nameof(TeacherBasicInformation.TeacherId)"
                                SelectionMode="DataGridSelectionMode.SingleSelectedDataRow"
                                SelectAllMode="DataGridSelectAllMode.AllPages"
                                OptimizedMultipleSelectionChanged="OnSelectionChanged"
                                CssClass="datagrid-border-radius-top-0 mw-1100">
                        <DxDataGridSelectionColumn Width="50px"></DxDataGridSelectionColumn>
                        <DxDataGridColumn Field="@nameof(TeacherBasicInformation.Teacher_Name)" Width="300px"></DxDataGridColumn>
                        <DxDataGridColumn Field="@nameof(TeacherBasicInformation.Email_Address)" Width="300px"></DxDataGridColumn>
                        
                        @*<DxDataGridCommandColumn Width="150px"
                                 EditButtonVisible="true" NewButtonVisible="false" DeleteButtonVisible="false">
        </DxDataGridCommandColumn>*@
                    </DxDataGrid>
                    <div style="text-align:center;">
                        <DxButton RenderStyle="ButtonRenderStyle.Primary" RenderStyleMode="ButtonRenderStyleMode.Contained" Text="Save" SizeMode="SizeMode.Medium" />
                    </div>
                </div>
                <br />
                <br />
                <div class="searchbar_style">
                    <center><h5>Select Graduate Course</h5></center>
                    <div>
                        @* this TextBox is used to search the data  *@
                        <DxTextBox ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                                   SizeMode="SizeMode.Small"
                                   NullText="Search for Graduate course ...."></DxTextBox>
                    </div>
                    <br />

                    <DxDataGrid Data="@graduateCourseList"
                                @ref="@graduateCourseGrid"
                                KeyFieldName="@nameof(GraduateCourse.GraduateCourseId)"
                                SelectionMode="DataGridSelectionMode.OptimizedMultipleSelection"
                                SelectAllMode="DataGridSelectAllMode.AllPages"
                                OptimizedMultipleSelectionChanged="OnSelectionGraduateCourse"
                                   CssClass="datagrid-border-radius-top-0 mw-1100">
                        <DxDataGridSelectionColumn></DxDataGridSelectionColumn>
                        <DxDataGridColumn Field="@nameof(GraduateCourse.GraduateCourseName)" Caption="Graduate Course"></DxDataGridColumn>
                     

                    </DxDataGrid>
                </div>

            </Template>
        </DxGridLayoutItem>
        <DxGridLayoutItem Row="1" Column="1">
            <Template>
                <DxListBox Data="@Staff.DataSource"
                           @bind-Values="@Values"
                           style=" height: 426px; margin-top: 10px;">
                    @*<DxListEditorColumn FieldName="Id" Width="50px" />*@
                    <DxListEditorColumn FieldName="TeacherName" Caption="Teacher Name" />
                    <DxListEditorColumn FieldName="selectedGraduateCourse" Caption="Graduate Course" />
                </DxListBox>
            </Template>
        </DxGridLayoutItem>
    </Items>
</DxGridLayout>


@*<div class="border_style">*@
<div style="text-align:center;">
    <DxButton RenderStyle="ButtonRenderStyle.Primary" RenderStyleMode="ButtonRenderStyleMode.Contained" Text="Save" SizeMode="SizeMode.Medium" />
</div>
@*</div>*@

@code {
    DxDataGrid<TeacherBasicInformation> teacherGrid;

    DxDataGrid<GraduateCourse> graduateCourseGrid;
    bool gridInitialized;



    IEnumerable<TeacherBasicInformation> teacherList = Enumerable.Empty<TeacherBasicInformation>();
    //IEnumerable<TeacherBasicInformation> DataSource;
    IEnumerable<GraduateCourse> graduateCourseList;
    string teacherNames;
    string searchKey = null;
    int SelectedCount { get; set; }

    int StoredSelectedCount { get; set; }

    int StoredUnselectedCount { get; set; }





    protected override void OnInitialized()
    {


        teacherList = diIViewTeacherBasicInformationUseCase.ViewTeacherBasicInformation(searchKey);
        graduateCourseList = diIViewGraduateCourseUseCase.ViewGraduateCourse(searchKey);

        Console.WriteLine(teacherList);
        Console.WriteLine(graduateCourseList);
    }





    protected async Task OnSelectionChanged(DataGridSelection<TeacherBasicInformation> selection)
    {
        Console.WriteLine(selection);
        StoredSelectedCount = selection.SelectedKeysStored.Count();
        Console.WriteLine(StoredSelectedCount);
        StoredUnselectedCount = selection.UnselectedKeysStored.Count();
        var selectedKeys = await selection.SelectedKeys;
        SelectedCount = selectedKeys.Count();
        await InvokeAsync(StateHasChanged);
    }


    protected async Task OnSelectionGraduateCourse(DataGridSelection<GraduateCourse> selection)
    {
        Console.WriteLine(selection);
        StoredSelectedCount = selection.SelectedKeysStored.Count();
        Console.WriteLine(StoredSelectedCount);
        StoredUnselectedCount = selection.UnselectedKeysStored.Count();
        var selectedKeys = await selection.SelectedKeys;
        SelectedCount = selectedKeys.Count();
        await InvokeAsync(StateHasChanged);
    }
    //list view
    public class Person
    {
        public int Id { get; set; }
        public string TeacherName { get; set; }
        public string selectedGraduateCourse { get; set; }

        public string Text => $"{TeacherName} {selectedGraduateCourse}";
    }



    public static class Staff
    {
        private static readonly Lazy<List<Person>> dataSource = new Lazy<List<Person>>(() =>
        {
            var dataSource = new List<Person>() {
            new Person() { Id= 0 , TeacherName="Sanjana", selectedGraduateCourse="BBM" },

        };
            return dataSource;


        });
        public static List<Person> DataSource { get { return dataSource.Value; } }
    }
    IEnumerable<Person> Values { get; set; } = Staff.DataSource.Take(1);




}
